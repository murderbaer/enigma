default:
  image: registry.rivercry.com/arifhasanic/cmake/cmake:latest

variables:
  GIT_SUBMODULE_STRATEGY: recursive
  GIT_SUBMODULE_FORCE_HTTPS: "true"

stages:
  - test

test:
  stage: test
  tags:
    - linux-docker
  script:    
    - cd enigma_c
    - mkdir build
    - cd build
    - cmake -DENABLE_COVERAGE=ON ..
    - make
    - make test
    - make coverage
  artifacts:
    reports:
      coverage_report:
          coverage_format: cobertura
          path: enigma_c/build/coverage/coverage.info
    expire_in: 1 week